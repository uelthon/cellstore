import{q as y,R as u,j as m,t as Ee,r as F,n as V,a as ge,v as be,b as z,B as Ce,S as Oe,w as we,x as xe,y as Pe,u as H,I as je}from"./index.fc6d9256.js";var Q="https://js.stripe.com/v3",Ae=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,M="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Re=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Q,'"]')),t=0;t<e.length;t++){var n=e[t];if(!!Ae.test(n.src))return n}return null},_e=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(Q).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},Ne=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.36.0",startTime:t})},A=null,Le=function(e){return A!==null||(A=new Promise(function(t,n){if(typeof window>"u"){t(null);return}if(window.Stripe&&e&&console.warn(M),window.Stripe){t(window.Stripe);return}try{var a=Re();a&&e?console.warn(M):a||(a=_e(e)),a.addEventListener("load",function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(s){n(s);return}})),A},Ie=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return Ne(a,n),a},Z=Promise.resolve().then(function(){return Le(null)}),J=!1;Z.catch(function(r){J||console.warn(r)});var Te=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];J=!0;var a=Date.now();return Z.then(function(s){return Ie(s,t,a)})};function D(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function G(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?D(Object(t),!0).forEach(function(n){ee(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):D(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function R(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?R=function(e){return typeof e}:R=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(r)}function ee(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Be(r,e){return $e(r)||ke(r,e)||qe(r,e)||Ue()}function $e(r){if(Array.isArray(r))return r}function ke(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],a=!0,s=!1,c,d;try{for(t=t.call(r);!(a=(c=t.next()).done)&&(n.push(c.value),!(e&&n.length===e));a=!0);}catch(o){s=!0,d=o}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return n}}function qe(r,e){if(!!r){if(typeof r=="string")return K(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K(r,e)}}function K(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),t.current},j=function(e){return e!==null&&R(e)==="object"},We=function(e){return j(e)&&typeof e.then=="function"},Fe=function(e){return j(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},X="[object Object]",Me=function r(e,t){if(!j(e)||!j(t))return e===t;var n=Array.isArray(e),a=Array.isArray(t);if(n!==a)return!1;var s=Object.prototype.toString.call(e)===X,c=Object.prototype.toString.call(t)===X;if(s!==c)return!1;if(!s&&!n)return e===t;var d=Object.keys(e),o=Object.keys(t);if(d.length!==o.length)return!1;for(var E={},f=0;f<d.length;f+=1)E[d[f]]=!0;for(var S=0;S<o.length;S+=1)E[o[S]]=!0;var i=Object.keys(E);if(i.length!==d.length)return!1;var C=e,h=t,b=function(x){return r(C[x],h[x])};return i.every(b)},te=function(e,t,n){return j(e)?Object.keys(e).reduce(function(a,s){var c=!j(t)||!Me(e[s],t[s]);return n.includes(s)?(c&&console.warn("Unsupported prop change: options.".concat(s," is not a mutable property.")),a):c?G(G({},a||{}),{},ee({},s,e[s])):a},null):null},De="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",Y=function(e){if(e===null||Fe(e))return e;throw new Error(De)},Ge=function(e){if(We(e))return{tag:"async",stripePromise:Promise.resolve(e).then(Y)};var t=Y(e);return t===null?{tag:"empty"}:{tag:"sync",stripe:t}},I=u.createContext(null);I.displayName="ElementsContext";var Ke=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},re=function(e){var t=e.stripe,n=e.options,a=e.children,s=u.useMemo(function(){return Ge(t)},[t]),c=u.useState(function(){return{stripe:s.tag==="sync"?s.stripe:null,elements:s.tag==="sync"?s.stripe.elements(n):null}}),d=Be(c,2),o=d[0],E=d[1];u.useEffect(function(){var i=!0,C=function(b){E(function(g){return g.stripe?g:{stripe:b,elements:b.elements(n)}})};return s.tag==="async"&&!o.stripe?s.stripePromise.then(function(h){h&&i&&C(h)}):s.tag==="sync"&&!o.stripe&&C(s.stripe),function(){i=!1}},[s,o,n]);var f=L(t);u.useEffect(function(){f!==null&&f!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[f,t]);var S=L(n);return u.useEffect(function(){if(!!o.elements){var i=te(n,S,["clientSecret","fonts"]);i&&o.elements.update(i)}},[n,S,o.elements]),u.useEffect(function(){var i=o.stripe;!i||!i._registerWrapper||!i.registerAppInfo||(i._registerWrapper({name:"react-stripe-js",version:"1.10.0"}),i.registerAppInfo({name:"react-stripe-js",version:"1.10.0",url:"https://stripe.com/docs/stripe-js/react"}))},[o.stripe]),m(I.Provider,{value:o,children:a})};re.propTypes={stripe:y.exports.any,options:y.exports.object};var _=function(e){var t=u.useContext(I);return Ke(t,e)},Xe=function(){var e=_("calls useElements()"),t=e.elements;return t},Ye=function(){var e=_("calls useStripe()"),t=e.stripe;return t};y.exports.func.isRequired;var O=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),function(){t.current&&t.current.apply(t,arguments)}},w=function(){},Ve=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},l=function(e,t){var n="".concat(Ve(e),"Element"),a=function(o){var E=o.id,f=o.className,S=o.options,i=S===void 0?{}:S,C=o.onBlur,h=C===void 0?w:C,b=o.onFocus,g=b===void 0?w:b,x=o.onReady,ae=x===void 0?w:x,T=o.onChange,oe=T===void 0?w:T,B=o.onEscape,se=B===void 0?w:B,$=o.onClick,ie=$===void 0?w:$,k=o.onLoadError,ce=k===void 0?w:k,q=o.onLoaderStart,ue=q===void 0?w:q,le=_("mounts <".concat(n,">")),U=le.elements,P=u.useRef(null),N=u.useRef(null),pe=O(ae),fe=O(h),de=O(g),ve=O(ie),me=O(oe),ye=O(se),Se=O(ce),he=O(ue);u.useLayoutEffect(function(){if(P.current==null&&U&&N.current!=null){var v=U.create(e,i);P.current=v,v.mount(N.current),v.on("ready",function(){return pe(v)}),v.on("change",me),v.on("blur",fe),v.on("focus",de),v.on("escape",ye),v.on("loaderror",Se),v.on("loaderstart",he),v.on("click",ve)}});var W=L(i);return u.useEffect(function(){if(!!P.current){var v=te(i,W,["paymentRequest"]);v&&P.current.update(v)}},[i,W]),u.useLayoutEffect(function(){return function(){P.current&&(P.current.destroy(),P.current=null)}},[]),m("div",{id:E,className:f,ref:N})},s=function(o){_("mounts <".concat(n,">"));var E=o.id,f=o.className;return m("div",{id:E,className:f})},c=t?s:a;return c.propTypes={id:y.exports.string,className:y.exports.string,onChange:y.exports.func,onBlur:y.exports.func,onFocus:y.exports.func,onReady:y.exports.func,onClick:y.exports.func,onLoadError:y.exports.func,onLoaderStart:y.exports.func,options:y.exports.object},c.displayName=n,c.__elementType=e,c},p=typeof window>"u";l("auBankAccount",p);var ne=l("card",p);l("cardNumber",p);l("cardExpiry",p);l("cardCvc",p);l("fpxBank",p);l("iban",p);l("idealBank",p);l("p24Bank",p);l("epsBank",p);l("payment",p);l("paymentRequestButton",p);l("linkAuthentication",p);l("shippingAddress",p);l("affirmMessage",p);l("afterpayClearpayMessage",p);const ze="/api/payments",He=async r=>{const{data:e}=await Ee.post(ze,r);return e},Qe={payOut:He},Ze={style:{base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{fontFamily:"Arial, sans-serif",color:"#fa755a",iconColor:"#fa755a"}}};function Je(){return m("div",{className:"container-payments-card-element",children:m(ne,{options:Ze})})}const et=({user:r})=>{const[e,t]=F.exports.useState(r.address||""),[n,a]=F.exports.useState(!1),s=Ye(),c=Xe(),d=V(),o=ge();if(!r)return null;const f=r.cart.products,{total:S}=be(f),i={user:r.id,products:f,amount:S,address:e,status:"success"};return z("form",{className:"container-form-payments",onSubmit:async h=>{if(h.preventDefault(),a(!0),c==null)return;const b=await Qe.payOut({amount:S*100}),g=await s.confirmCardPayment(b.clientSecret,{payment_method:{card:c.getElement(ne),billing_details:{name:r.username}}});if(g.error)console.log(g.error.message),o(we([g.error.message,"danger"])),a(!1);else if(g.paymentIntent.status==="succeeded"){const x=await xe.createOrder(i);o(Pe(x)),t(""),a(!1),d("/success")}},children:["Address:",m("input",{value:e,onChange:h=>t(h.target.value),className:"payments-inputs",id:"address-pay",type:"text",placeholder:"Address",required:!0}),"Credit Card:",m(Je,{}),m(Ce,{variant:"success",type:"submit",disabled:!s||!c||f.length===0,children:n?m(Oe,{animation:"border",variant:"secondary"}):"Pay"})]})};const tt=Te("pk_test_51LesuYHNbYEEZKbu8GG5id1Pqlsu0uEKQREX84BqliGMoM4lmBL3SV10AQBXX3RPZ9MXjqxceOvqANtpKY3g7GLw00I8ItX7pl"),rt=()=>{const r=H(e=>e.user.value);return r?m(re,{stripe:tt,children:m(et,{user:r})}):null};const nt=()=>{const r=H(t=>t.user.value),e=V();return r?m("div",{className:"container-card-pay",children:z("div",{className:"container-card-pay-item",children:[m(je,{user:r,linkpay:!1}),m(rt,{})]})}):e("/")},ot=nt;export{ot as default};
